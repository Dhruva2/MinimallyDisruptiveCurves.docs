<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/MinimallyDisruptiveCurves.docs/libs/katex/katex.min.css"> <link rel=stylesheet  href="/MinimallyDisruptiveCurves.docs/libs/highlight/github.min.css"> <link rel=stylesheet  href="/MinimallyDisruptiveCurves.docs/css/jtd.css"> <link rel=icon  href="/MinimallyDisruptiveCurves.docs/assets/favicon.ico"> <title>Examples</title> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/MinimallyDisruptiveCurves.docs/" class=title > User guide </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/" class="menu-list-link ">Home</a> <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/installation/"class="menu-list-link ">Installation</a> <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/menu1/" class="menu-list-link ">How it works</a> <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/sceptic/" class="menu-list-link ">Q&A with a sceptic</a> <li class="menu-list-item active"><a href="/MinimallyDisruptiveCurves.docs/menu2/" class="menu-list-link active">Examples</a> <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/menu3/" class="menu-list-link ">Tips & Tricks</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="#" class=menu-list-link >Submenu</a> </ul> </ul> </div> <div class=footer > This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target=_blank >Jekyll theme</a>. </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > <a id=github  href="https://github.com/Dhruva2/MinimallyDisruptiveCurves.jl">MinimallyDisruptiveCurves.jl on GitHub</a> </div> <div class=franklin-content ><h1 id=examples ><a href="#examples" class=header-anchor >Examples</a></h1> <div class=franklin-toc ><ol><li><a href="#pulling_notebooks_from_github">Pulling notebooks from Github</a><li><a href="#a_copy-paste_minimal_example">A copy-paste, minimal example</a><ol><li><a href="#lotka_volterra_model_of_predator-prey_interactions">Lotka Volterra model of predator-prey interactions</a><li><a href="#minimally_disruptive_curve_1">Minimally disruptive curve 1</a><li><a href="#minimally_disruptive_curve_2">Minimally disruptive curve 2</a><li><a href="#the_code">The code</a><li><a href="#lessons">Lessons</a></ol></ol></div> <p> <div class=row > <div class=container > <img class=left  src="/MinimallyDisruptiveCurves.docs/assets/will_it_work.png"> <div style="clear: both"></div> </div> </div> &#40;<em>Credit: https://xkcd.com/1742/</em>&#41;</p> <h2 id=pulling_notebooks_from_github ><a href="#pulling_notebooks_from_github" class=header-anchor >Pulling notebooks from Github</a></h2> <p>Tutorial notebooks are in the MDCExamples repository. </p> <ol> <li><p>At a terminal, in the directory of your choice, type the following commands:</p> </ol> <pre><code class=language-julia >git clone https://github.com/Dhruva2/MDCExamples.git
cd MDCExamples
julia</code></pre> <p>This clones the github repository with the examples, changes location to the cloned repository, and starts a julia session.</p> <ol start=2 > <li><p>In your new julia session, activate the environment:</p> </ol> <pre><code class=language-julia >&#93; activate .</code></pre>
<p><code>&#93;</code> switches to the package manager. <code>activate .</code> activates the predetermined package environment in which the notebooks can be run.</p>
<ol start=3 >
<li><p>&#40;optional&#41;: Precompile the dependencies to save a few minutes later</p>

</ol>
<pre><code class=language-julia >&#93; precompile</code></pre>
<ol start=5 >
<li><p>Open jupyter notebooks:</p>

</ol>
<pre><code class=language-julia >using IJulia
notebook&#40;dir&#61;pwd&#40;&#41;&#41;</code></pre>
<p>and then open/run the individual notebooks in the notebook environment. </p>
<p><strong>Suggested order to go through notebooks</strong></p>
<ol>
<li><p><code>Transforming_cost_functions.ipynb</code></p>

<li><p><code>MassSpringExample.ipynb</code></p>

<li><p><code>NFKB_example.ipynb</code></p>

<li><p><code>stg_neuron_prelim_collocation.ipynb</code></p>

<li><p><code>CircadianOscillator.ipynb</code></p>

</ol>
<ul>
<li><p>No. 1 just shows you how to play around with cost functions</p>

<li><p>No. 2 is an example on an extremely simple model. Running curves takes fractions of a second here, so it&#39;s a good playground for playing with curve settings.</p>

<li><p>No. 3 is fairly detailed. It&#39;s useful if you want to see how scientific insight can be gained from looking at Minimally Disruptive Curves. Each curve on this notebook takes 2-10 mins to generate on my laptop &#40;2017 macbook pro&#41;.</p>

<li><p>Nos 4. and 5. show you how to use the &#40;much quicker to evaluate&#41; collocation cost. I&#39;ve generated, but haven&#39;t really had time to properly analyse, the minimally disruptive curves.</p>

</ul>
<h2 id=a_copy-paste_minimal_example ><a href="#a_copy-paste_minimal_example" class=header-anchor >A copy-paste, minimal example</a></h2>
<ul>
<li><p>This example is less didactic than the notebooks, but useful for somebody who just wants to get things working quickly.</p>

<li><p>We do a cursory analysis of the Lotka-Volterra, predator-prey differential equation model. This is often used as a toy example for global sensitivity analysis tools, see e.g. the following web links: <a href="https://cran.r-project.org/web/packages/ODEsensitivity/vignettes/ODEsensitivity.html">a</a>, <a href="https://diffeq.sciml.ai/v6.9/analysis/global_sensitivity/">b</a>, <a href="https://strimas.com/post/lotka-volterra/">c</a>. Because it&#39;s really simple.</p>

</ul>
<ul>
<li><p>You can copy and paste the code at the bottom, and run it as a .jl script. It runs in seconds &#40;after package/function pre-compilation&#41;. Just make sure you add all the package dependencies first:</p>

</ul>
<pre><code class=language-julia >&#93; add OrdinaryDiffEq, ForwardDiff, Statistics, Plots, LinearAlgebra, LaTeXStrings
&#93; add https://github.com/Dhruva2/MinimallyDisruptiveCurves.jl.git</code></pre>
<ul>
<li><p>Note that one of the model features we analyse is <strong>non-differentiable</strong>. Mathematically. Computationally everything works fine, as we&#39;ll explain.</p>

</ul>
<div class=unobtrusivebox ><h3 id=lotka_volterra_model_of_predator-prey_interactions ><a href="#lotka_volterra_model_of_predator-prey_interactions" class=header-anchor >Lotka Volterra model of predator-prey interactions</a></h3>
<p>The dynamics for the system are:</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mtext>🐁</mtext></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><msub><mi>p</mi><mn>1</mn></msub><mtext>🐁</mtext><mo>−</mo><msub><mi>p</mi><mn>2</mn></msub><mtext>🐁🦉</mtext><mspace linebreak=newline ></mspace><mfrac><mrow><mi>d</mi><mtext>🦉</mtext></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><msub><mi>p</mi><mn>3</mn></msub><mtext>🦉</mtext><mo>+</mo><msub><mi>p</mi><mn>4</mn></msub><mtext>🐁🦉</mtext></mrow><annotation encoding="application/x-tex"> \frac{d
🐁}{dt} =  p_1 🐁 - p_2🐁 🦉 \\
\frac{d
🦉}{dt} = -p_3🦉   + p_4 🐁 🦉
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class=mord >🐁</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >🐁</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >🐁</span><span class=mord >🦉</span></span><span class="mspace newline"></span><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class=mord >🦉</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class=mord >−</span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >🦉</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >🐁</span><span class=mord >🦉</span></span></span></span></span>
<ul>
<li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">p_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">p_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are the birth and death rates of 🐁 </p>

<li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">p_3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">p_4</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are the birth and death rates of 🦉</p>

</ul>
<p>... and here is a time-course of their populations when <code>p &#61; &#91;1.5,1.0,3.0,1.0&#93;</code>. We call these values the <strong>nominal parameters</strong>. <br/> <br/> <strong>Nominal system</strong> &#40;i.e. simulated with nominal parameter values&#41; 
<div class=row >
  <div class=container >
    <img class=left  src="/MinimallyDisruptiveCurves.docs/assets/nominal_lv.svg">
    <div style="clear: both"></div>      
  </div>
</div>
</p></div>
<ul>
<li><p>We will follow <a href="https://diffeq.sciml.ai/v6.9/analysis/global_sensitivity/">b</a> in having <strong>two</strong> features of interest: </p>
<ul>
<li><p><strong>mean</strong> population of 🐁  over time</p>

<li><p><strong>max</strong> population of 🦉 over time</p>

</ul>

<li><p>The model features of the nominal system are <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >[</mo><mn>2.98</mn><mo separator=true >,</mo><mn>4.57</mn><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">[2.98, 4.57]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >[</span><span class=mord >2</span><span class=mord >.</span><span class=mord >9</span><span class=mord >8</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >4</span><span class=mord >.</span><span class=mord >5</span><span class=mord >7</span><span class=mclose >]</span></span></span></span></p>

<li><p>Our <strong>cost function on model behaviour</strong> is the mean square deviation from these nominal model features. </p>

</ul>
<div class=infobox ><p><strong>By the way</strong> In your ecology class, you may have heard of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi mathvariant=normal >/</mi><mi>K</mi></mrow><annotation encoding="application/x-tex">r/K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class=mord >/</span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span> selection. This is a &#40;criticised&#41; theory of how there are two extremal strategies that individual species trade off between:  </p>
<ul>
<li><p>r-Strategists &#40;e.g. rabbits&#41;: <strong>high</strong> birth and death rate. <strong>low</strong> investment in individual organisms</p>

<li><p>K-strategists &#40;e.g. humans&#41;: <strong>low</strong> birth and death rate. <strong>high</strong> investment in individual organisms</p>

</ul>
<p>We will use this terminology in our description of the MD curves.</p></div>
<ul>
<li><p>By running the code at the bottom of the page twice, setting <code>whichdir &#61; 1</code> and <code>whichdir&#61;2</code> respectively, we get two MD curves &#40;see below&#41;.</p>

</ul>
<div class=unobtrusivebox ><h3 id=minimally_disruptive_curve_1 ><a href="#minimally_disruptive_curve_1" class=header-anchor >Minimally disruptive curve 1</a></h3>

<div class=row >
  <div class=container >
    <img class=left  src="/MinimallyDisruptiveCurves.docs/assets/mdc1.gif">
    <div style="clear: both"></div>      
  </div>
</div>

<ul>
<li><p>As we move along the curve, predators move towards an <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>-strategy, and prey moves towards a <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span>-strategy.</p>

<li><p>We can also move in the opposite direction &#40;prey to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> strategy, predator to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span>&#41;. To avoid figure clutter, run the pasted code yourself to see this&#33;</p>

</ul></div>
<div class=unobtrusivebox ><h3 id=minimally_disruptive_curve_2 ><a href="#minimally_disruptive_curve_2" class=header-anchor >Minimally disruptive curve 2</a></h3>

<div class=row >
  <div class=container >
    <img class=left  src="/MinimallyDisruptiveCurves.docs/assets/mdc2.gif">
    <div style="clear: both"></div>      
  </div>
</div>

<ul>
<li><p>This curve instead finds a way to modulate the frequency of predator prey interactions, while preserving model features</p>

<li><p>Note how it abruptly changes direction when slowing frequency eventually prevents model features being maintained &#40;as the period approaches the length of simulation&#41;. It goes from decreasing the frequency to increasing it.</p>

</ul></div>
<h3 id=the_code ><a href="#the_code" class=header-anchor >The code</a></h3>
<ul>
<li><p>Gives static plots of the minimally disruptive curves. Code for the gifs was a bit more involved&#33;</p>

</ul>
<pre><code class=language-julia >using OrdinaryDiffEq, ForwardDiff, MinimallyDisruptiveCurves, Statistics, Plots, LinearAlgebra, LaTeXStrings

#which md curve to plot
which_dir &#61; 2

## define dynamics of differential equation
function f&#40;du,u,p,t&#41;
  du&#91;1&#93; &#61; p&#91;1&#93;*u&#91;1&#93; - p&#91;2&#93;*u&#91;1&#93;*u&#91;2&#93; #prey
  du&#91;2&#93; &#61; -p&#91;3&#93;*u&#91;2&#93; &#43; p&#91;4&#93;*u&#91;1&#93;*u&#91;2&#93; #predator
end

u0 &#61; &#91;1.0;1.0&#93; # initial populations
tspan &#61; &#40;0.0,10.0&#41; #time span to simulate over
t &#61; collect&#40;range&#40;0, stop&#61;10., length&#61;200&#41;&#41; # time points to measure
p &#61; &#91;1.5,1.0,3.0,1.0&#93; # initial parameter values
nom_prob &#61; ODEProblem&#40;f,u0,tspan,p&#41; # package as an ODE problem
nom_sol &#61; solve&#40;nom_prob, Tsit5&#40;&#41;&#41; # solve 


## Model features of interest are mean prey population, and max predator population &#40;over time&#41;
function features&#40;p&#41;
  prob &#61; remake&#40;nom_prob; p&#61;p&#41;
  sol &#61; solve&#40;prob, Tsit5&#40;&#41;; saveat &#61; t&#41;
  return &#91;mean&#40;sol&#91;1,:&#93;&#41;, maximum&#40;sol&#91;2,:&#93;&#41;&#93;
end

nom_features &#61; features&#40;p&#41;

## loss function, we can take as l2 difference of features vs nominal features
function loss&#40;p&#41;
  prob &#61; remake&#40;nom_prob; p&#61;p&#41;
  p_features &#61; features&#40;p&#41;
  loss &#61; sum&#40;abs2, p_features - nom_features&#41;
  return loss
end

## gradient of loss function
function lossgrad&#40;p,g&#41;
  g&#91;:&#93; &#61; ForwardDiff.gradient&#40;p&#41; do p
    loss&#40;p&#41;
  end
  return loss&#40;p&#41;
end

## package the loss and gradient into a DiffCost structure
cost &#61; DiffCost&#40;loss, lossgrad&#41;

&quot;&quot;&quot;
We evaluate the hessian once only, at p.
Why? to find locally insensitive directions of parameter perturbation
The small eigenvalues of the Hessian are one easy way of defining these directions 
&quot;&quot;&quot;
hess0 &#61; ForwardDiff.hessian&#40;loss,p&#41;
ev&#40;i&#41; &#61; eigen&#40;hess0&#41;.vectors&#91;:,i&#93;

## Now we set up a minimally disruptive curve, with nominal parameters p and initial direction ev&#40;1&#41; 
init_dir &#61; ev&#40;which_dir&#41;; momentum &#61; 1.; span &#61; &#40;-15.,15.&#41;
curve_prob &#61; curveProblem&#40;cost, p, init_dir, momentum, span&#41;
@time mdc &#61; evolve&#40;curve_prob, Tsit5&#41;

function sol_at_p&#40;p&#41;
  prob &#61; remake&#40;nom_prob; p&#61;p&#41;
  sol &#61; solve&#40;prob, Tsit5&#40;&#41;&#41;
end

p1 &#61; plot&#40;mdc; pnames &#61; &#91;L&quot;p_1&quot; L&quot;p_2&quot; L&quot;p_3&quot; L&quot;p_4&quot;&#93;&#41;

cost_vec &#61; &#91;mdc.cost&#40;el&#41; for el in eachcol&#40;trajectory&#40;mdc&#41;&#41;&#93;
p2 &#61; plot&#40;distances&#40;mdc&#41;, log.&#40;cost_vec&#41;, ylabel &#61; &quot;log&#40;cost&#41;&quot;, xlabel &#61; &quot;distance&quot;, title &#61; &quot;cost over MD curve&quot;&#41;;

mdc_plot &#61; plot&#40;p1,p2, layout&#61;&#40;2,1&#41;, size &#61; &#40;800,800&#41;&#41;

nominal_trajectory &#61; plot&#40;sol_at_p&#40;mdc&#40;0.&#41;&#91;:states&#93;&#41;, label &#61; &#91;&quot;prey&quot; &quot;predator&quot;&#93;&#41;
perturbed_trajectory &#61; plot&#40;sol_at_p&#40;mdc&#40;-15.&#41;&#91;:states&#93;&#41;, label &#61; &#91;&quot;prey&quot; &quot;predator&quot;&#93;&#41;
traj_comparison &#61; plot&#40;nominal_trajectory, perturbed_trajectory, layout &#61; &#40;2,1&#41;, xlabel &#61; &quot;time&quot;, ylabel &#61; &quot;population&quot;&#41;</code></pre>
<h3 id=lessons ><a href="#lessons" class=header-anchor >Lessons</a></h3>
<ul>
<li><p>MinimallyDisruptiveCurves.jl showed how we could continuously vary the parameters of the Lotka-Volterra model, while preserving</p>
<ol>
<li><p>mean prey population over time</p>

<li><p>max predator population over time </p>

</ol>

<li><p>One strategy &#40;MDC1&#41; was to alter the parameters to increase &#40;decrease&#41; birth and death rates of the predators while decreasing &#40;increasing&#41; those of the prey. Along the axis of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>-strategies to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span>-strategies, this corresponds to one species moving in one direction, with the other going in reverse.</p>

<li><p>Another strategy &#40;MDC2&#41; was to modulate the frequency of the oscillations. MDC2 showed us exactly how to change the parameters to continuously modulate this frequency.</p>

</ul>
<div class=infobox ><p><strong>By the way</strong></p>
<p>The maximum predator population over time is a <strong>non differentiable</strong> function of the solution. How come this worked?</p>
<ol>
<li><p>First note that ReLu units in neural networks are also technically nondifferentiable at a point, but are still used in differentiable machine learning models. Same reason&#33;</p>

<li><p>OK the details? The maximum of a collection of elements &#40;predator measurements over time&#41;, is differentiable except at crossing points, where two elements share a maximal value. Different values of predator&#40;t&#41; will never have <strong>exactly</strong> the same value, due to numerical error as well as equation dynamics. So it works out&#33; Indeed, notice the timepoints at which maximal values are attained changes with the model parameters.</p>

</ol></div>
<div class=page-foot >
  <div class=copyright >
    &copy; Dhruva Venkita Raman. Last modified: October 13, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div>
</div>
    </div> 
    </div> 
    </div> <!-- end of class page-wrap-->
    
      



    
    
      <script src="/MinimallyDisruptiveCurves.docs/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>