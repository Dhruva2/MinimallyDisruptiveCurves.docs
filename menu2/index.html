<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/MinimallyDisruptiveCurves.docs/libs/katex/katex.min.css"> <link rel=stylesheet  href="/MinimallyDisruptiveCurves.docs/libs/highlight/github.min.css"> <link rel=stylesheet  href="/MinimallyDisruptiveCurves.docs/css/jtd.css"> <link rel=icon  href="/MinimallyDisruptiveCurves.docs/assets/favicon.ico"> <title>Examples</title> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/MinimallyDisruptiveCurves.docs/" class=title > User guide </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/" class="menu-list-link ">Home</a> <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/installation/"class="menu-list-link ">Installation</a> <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/menu1/" class="menu-list-link ">How it works</a> <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/sceptic/" class="menu-list-link ">Q&A with a sceptic</a> <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/Audience_questions/" class="menu-list-link ">Questions from the Audience</a> <li class="menu-list-item active"><a href="/MinimallyDisruptiveCurves.docs/menu2/" class="menu-list-link active">Examples</a> <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/menu3/" class="menu-list-link ">Tips & Tricks</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="#" class=menu-list-link >Submenu</a> </ul> </ul> </div> <div class=footer > This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target=_blank >Jekyll theme</a>. </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > <a id=github  href="https://github.com/Dhruva2/MinimallyDisruptiveCurves.jl">MinimallyDisruptiveCurves.jl on GitHub</a> </div> <div class=franklin-content ><h1 id=examples ><a href="#examples" class=header-anchor >Examples</a></h1> <div class=franklin-toc ><ol><li><a href="#tutorial_notebooks">Tutorial notebooks</a><li><a href="#a_copy-paste_minimal_example">A copy-paste, minimal example</a><ol><li><a href="#lotka_volterra_model_of_predator-prey_interactions">Lotka Volterra model of predator-prey interactions</a><li><a href="#minimally_disruptive_curve_1">Minimally disruptive curve 1</a><li><a href="#minimally_disruptive_curve_2">Minimally disruptive curve 2</a><li><a href="#the_code">The code</a><li><a href="#lessons">Lessons</a></ol></ol></div> <p> <div class=row > <div class=container > <img class=left  src="/MinimallyDisruptiveCurves.docs/assets/will_it_work.png"> <div style="clear: both"></div> </div> </div> &#40;<em>Credit: https://xkcd.com/1742/</em>&#41;</p> <h2 id=tutorial_notebooks ><a href="#tutorial_notebooks" class=header-anchor >Tutorial notebooks</a></h2> <p>Tutorial Pluto notebooks are in the <a href="https://github.com/Dhruva2/MDCExamples">MDCExamples</a> repository. Pluto notebooks are like Jupyter notebooks, but &#40;IMO&#41; better for Julia. To install <a href="https://github.com/fonsp/Pluto.jl">Pluto</a>, open a Julia REPL, and type</p> <pre><code class="julia hljs">]add Pluto
<span class=hljs-keyword >using</span> Pluto
Pluto.run()</code></pre> <p>Install/open <a href="https://github.com/fonsp/Pluto.jl">Pluto.jl</a> and copy one of the tutorial URLs into the Pluto search bar. I&#39;ve put them in a suggested order:</p> <ol> <li><p><a href="https://github.com/Dhruva2/MDCExamples/blob/master/Transforming_cost_functions.jl">https://github.com/Dhruva2/MDCExamples/blob/master/Transforming<em>cost</em>functions.jl</a></p> </ol> <ul> <li><p>Not about MinimallyDisruptiveCurves specifically, but introduces you to the cost function transformations that are useful when iteratively running MDCs. </p> </ul> <ol start=2 > <li><p><a href="https://github.com/Dhruva2/MDCExamples/blob/master/mass_spring_intro.jl">https://github.com/Dhruva2/MDCExamples/blob/master/mass<em>spring</em>intro.jl</a></p> </ol> <ul> <li><p>Applying MDCs to the simplest possible differential equation: a damped oscillator. MDC generation happens in the blink of an eye for a model this simple, so it&#39;s useful for playing around. </p> </ul> <ol start=3 > <li><p><a href="https://github.com/Dhruva2/MDCExamples/blob/master/NFKBExample.jl">https://github.com/Dhruva2/MDCExamples/blob/master/NFKBExample.jl</a></p> </ol> <ul> <li><p>Takes a seminal model of the NFkB metabolic pathway. Shows how you can iteratively extract mechanistic insight from the model using MDCs. </p> </ul> <ol start=4 > <li><p><a href="https://github.com/Dhruva2/MDCExamples/blob/master/CircadianOscillator.jl">https://github.com/Dhruva2/MDCExamples/blob/master/CircadianOscillator.jl</a></p> </ol> <ul> <li><p>Takes a seminal but rather large model of the intracellular Circadian rhythm. Shows how you can use a &#39;cheap&#39; loss function &#40;the injection/collocation&#41; loss, to massively speed up MDC generation. The MDCs seem eminently interpretable, but I haven&#39;t interpreted them yet. Have a go, if you&#39;re a Circadian expert&#33;</p> </ul> <ol start=5 > <li><p><a href="https://github.com/Dhruva2/MDCExamples/blob/master/calcium_homeo.jl">https://github.com/Dhruva2/MDCExamples/blob/master/calcium_homeo.jl</a></p> </ol> <ul> <li><p>&#40;Built by Andrea Ramirez Hincapie&#41;. I&#39;m a neuron. I have to modulate my electrical activity &#40;e.g. from spiking to bursting&#41;. This is called neuromodulation. I also have to maintain calcium homeostasis: internal calcium concentration needs to be in a tight range for me to be happy. But changing baseline electrical activity changes baseline calcium&#33; How can I safely neuromodulate, while preserving calcium concentration? MDCs tell me how.... </p> </ul> <h2 id=a_copy-paste_minimal_example ><a href="#a_copy-paste_minimal_example" class=header-anchor >A copy-paste, minimal example</a></h2> <ul> <li><p>This example is less didactic than the notebooks, but useful for somebody who just wants to get things working quickly.</p> <li><p>We do a cursory analysis of the Lotka-Volterra, predator-prey differential equation model. This is often used as a toy example for global sensitivity analysis tools, see e.g. the following web links: <a href="https://cran.r-project.org/web/packages/ODEsensitivity/vignettes/ODEsensitivity.html">a</a>, <a href="https://diffeq.sciml.ai/v6.9/analysis/global_sensitivity/">b</a>, <a href="https://strimas.com/post/lotka-volterra/">c</a>. Because it&#39;s really simple.</p> </ul> <ul> <li><p>You can copy and paste the code at the bottom, and run it as a .jl script. It runs in seconds &#40;after package/function pre-compilation&#41;. Just make sure you add all the package dependencies first:</p> </ul> <pre><code class="julia hljs">] add OrdinaryDiffEq, ForwardDiff, Statistics, Plots, LinearAlgebra, LaTeXStrings
] add https://github.com/Dhruva2/MinimallyDisruptiveCurves.jl.git</code></pre> <ul> <li><p>Note that one of the model features we analyse is <strong>non-differentiable</strong>. Mathematically. Computationally everything works fine, as we&#39;ll explain.</p> </ul> <div class=unobtrusivebox ><h3 id=lotka_volterra_model_of_predator-prey_interactions ><a href="#lotka_volterra_model_of_predator-prey_interactions" class=header-anchor >Lotka Volterra model of predator-prey interactions</a></h3> <p>The dynamics for the system are:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mtext>🐁</mtext></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><msub><mi>p</mi><mn>1</mn></msub><mtext>🐁</mtext><mo>−</mo><msub><mi>p</mi><mn>2</mn></msub><mtext>🐁🦉</mtext><mspace linebreak=newline ></mspace><mfrac><mrow><mi>d</mi><mtext>🦉</mtext></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><msub><mi>p</mi><mn>3</mn></msub><mtext>🦉</mtext><mo>+</mo><msub><mi>p</mi><mn>4</mn></msub><mtext>🐁🦉</mtext></mrow><annotation encoding="application/x-tex"> \frac{d 🐁}{dt} = p_1 🐁 - p_2🐁 🦉 \\ \frac{d 🦉}{dt} = -p_3🦉 + p_4 🐁 🦉 </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class=mord >🐁</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >🐁</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >🐁</span><span class=mord >🦉</span></span><span class="mspace newline"></span><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class=mord >🦉</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class=mord >−</span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >🦉</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >🐁</span><span class=mord >🦉</span></span></span></span></span> <ul> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">p_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">p_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are the birth and death rates of 🐁 </p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">p_3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">p_4</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathdefault">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are the birth and death rates of 🦉</p> </ul> <p>... and here is a time-course of their populations when <code>p &#61; &#91;1.5,1.0,3.0,1.0&#93;</code>. We call these values the <strong>nominal parameters</strong>. <br/> <br/> <strong>Nominal system</strong> &#40;i.e. simulated with nominal parameter values&#41; <div class=row > <div class=container > <img class=left  src="/MinimallyDisruptiveCurves.docs/assets/nominal_lv.svg"> <div style="clear: both"></div> </div> </div> </p></div> <ul> <li><p>We will follow <a href="https://diffeq.sciml.ai/v6.9/analysis/global_sensitivity/">b</a> in having <strong>two</strong> features of interest: </p> <ul> <li><p><strong>mean</strong> population of 🐁 over time</p> <li><p><strong>max</strong> population of 🦉 over time</p> </ul> <li><p>The model features of the nominal system are <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >[</mo><mn>2.98</mn><mo separator=true >,</mo><mn>4.57</mn><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">[2.98, 4.57]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >[</span><span class=mord >2</span><span class=mord >.</span><span class=mord >9</span><span class=mord >8</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >4</span><span class=mord >.</span><span class=mord >5</span><span class=mord >7</span><span class=mclose >]</span></span></span></span></p> <li><p>Our <strong>cost function on model behaviour</strong> is the mean square deviation from these nominal model features. </p> </ul> <div class=infobox ><p><strong>By the way</strong> In your ecology class, you may have heard of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi mathvariant=normal >/</mi><mi>K</mi></mrow><annotation encoding="application/x-tex">r/K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class=mord >/</span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span> selection. This is a &#40;criticised&#41; theory of how there are two extremal strategies that individual species trade off between: </p> <ul> <li><p>r-Strategists &#40;e.g. rabbits&#41;: <strong>high</strong> birth and death rate. <strong>low</strong> investment in individual organisms</p> <li><p>K-strategists &#40;e.g. humans&#41;: <strong>low</strong> birth and death rate. <strong>high</strong> investment in individual organisms</p> </ul> <p>We will use this terminology in our description of the MD curves.</p></div> <ul> <li><p>By running the code at the bottom of the page twice, setting <code>whichdir &#61; 1</code> and <code>whichdir&#61;2</code> respectively, we get two MD curves &#40;see below&#41;.</p> </ul> <div class=unobtrusivebox ><h3 id=minimally_disruptive_curve_1 ><a href="#minimally_disruptive_curve_1" class=header-anchor >Minimally disruptive curve 1</a></h3> <div class=row > <div class=container > <img class=left  src="/MinimallyDisruptiveCurves.docs/assets/mdc1.gif"> <div style="clear: both"></div> </div> </div> <ul> <li><p>As we move along the curve, predators move towards an <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>-strategy, and prey moves towards a <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span>-strategy.</p> <li><p>We can also move in the opposite direction &#40;prey to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> strategy, predator to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span>&#41;. To avoid figure clutter, run the pasted code yourself to see this&#33;</p> </ul></div> <div class=unobtrusivebox ><h3 id=minimally_disruptive_curve_2 ><a href="#minimally_disruptive_curve_2" class=header-anchor >Minimally disruptive curve 2</a></h3> <div class=row > <div class=container > <img class=left  src="/MinimallyDisruptiveCurves.docs/assets/mdc2.gif"> <div style="clear: both"></div> </div> </div> <ul> <li><p>This curve instead finds a way to modulate the frequency of predator prey interactions, while preserving model features</p> <li><p>Note how it abruptly changes direction when slowing frequency eventually prevents model features being maintained &#40;as the period approaches the length of simulation&#41;. It goes from decreasing the frequency to increasing it.</p> </ul></div> <h3 id=the_code ><a href="#the_code" class=header-anchor >The code</a></h3> <ul> <li><p>Gives static plots of the minimally disruptive curves. Code for the gifs was a bit more involved&#33;</p> </ul> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> OrdinaryDiffEq, ForwardDiff, MinimallyDisruptiveCurves, Statistics, Plots, LinearAlgebra, LaTeXStrings

<span class=hljs-comment >#which md curve to plot</span>
which_dir = <span class=hljs-number >2</span>

<span class=hljs-comment >## define dynamics of differential equation</span>
<span class=hljs-keyword >function</span> f(du, u, p, t)
    du[<span class=hljs-number >1</span>] = p[<span class=hljs-number >1</span>] * u[<span class=hljs-number >1</span>] - p[<span class=hljs-number >2</span>] * u[<span class=hljs-number >1</span>] * u[<span class=hljs-number >2</span>] <span class=hljs-comment >#prey</span>
    du[<span class=hljs-number >2</span>] = -p[<span class=hljs-number >3</span>] * u[<span class=hljs-number >2</span>] + p[<span class=hljs-number >4</span>] * u[<span class=hljs-number >1</span>] * u[<span class=hljs-number >2</span>] <span class=hljs-comment >#predator</span>
<span class=hljs-keyword >end</span>

u0 = [<span class=hljs-number >1.0</span>; <span class=hljs-number >1.0</span>] <span class=hljs-comment ># initial populations</span>
tspan = (<span class=hljs-number >0.0</span>, <span class=hljs-number >10.0</span>) <span class=hljs-comment >#time span to simulate over</span>
t = collect(range(<span class=hljs-number >0</span>, stop=<span class=hljs-number >10.0</span>, length=<span class=hljs-number >200</span>)) <span class=hljs-comment ># time points to measure</span>
p = [<span class=hljs-number >1.5</span>, <span class=hljs-number >1.0</span>, <span class=hljs-number >3.0</span>, <span class=hljs-number >1.0</span>] <span class=hljs-comment ># initial parameter values</span>
nom_prob = ODEProblem(f, u0, tspan, p) <span class=hljs-comment ># package as an ODE problem</span>
nom_sol = solve(nom_prob, Tsit5()) <span class=hljs-comment ># solve </span>


<span class=hljs-comment >## Model features of interest are mean prey population, and max predator population (over time)</span>
<span class=hljs-keyword >function</span> features(p)
    prob = remake(nom_prob; p=p)
    sol = solve(prob, Tsit5(); saveat=t)
    <span class=hljs-keyword >return</span> [mean(sol[<span class=hljs-number >1</span>, :]), maximum(sol[<span class=hljs-number >2</span>, :])]
<span class=hljs-keyword >end</span>

nom_features = features(p)

<span class=hljs-comment >## loss function, we can take as l2 difference of features vs nominal features</span>
<span class=hljs-keyword >function</span> loss(p)
    prob = remake(nom_prob; p=p)
    p_features = features(p)
    loss = sum(abs2, p_features - nom_features)
    <span class=hljs-keyword >return</span> loss
<span class=hljs-keyword >end</span>

<span class=hljs-comment >## gradient of loss function</span>
<span class=hljs-keyword >function</span> lossgrad(p, g)
    g[:] = ForwardDiff.gradient(p) <span class=hljs-keyword >do</span> p
        loss(p)
    <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >return</span> loss(p)
<span class=hljs-keyword >end</span>

<span class=hljs-comment >## package the loss and gradient into a DiffCost structure</span>
cost = DiffCost(loss, lossgrad)

<span class=hljs-string >&quot;&quot;&quot;
We evaluate the hessian once only, at p.
Why? to find locally insensitive directions of parameter perturbation
The small eigenvalues of the Hessian are one easy way of defining these directions 
&quot;&quot;&quot;</span>
hess0 = ForwardDiff.hessian(loss, p)
ev(i) = eigen(hess0).vectors[:, i]

<span class=hljs-comment >## Now we set up a minimally disruptive curve, with nominal parameters p and initial direction ev(1) </span>
init_dir = ev(which_dir);
momentum = <span class=hljs-number >1.0</span>;
span = (-<span class=hljs-number >15.0</span>, <span class=hljs-number >15.0</span>);
curve_prob = MDCProblem(cost, p, init_dir, momentum, span)
<span class=hljs-meta >@time</span> mdc = evolve(curve_prob, Tsit5)

<span class=hljs-keyword >function</span> sol_at_p(p)
    prob = remake(nom_prob; p=p)
    sol = solve(prob, Tsit5())
<span class=hljs-keyword >end</span>

p1 = plot(mdc; pnames=[<span class=hljs-string >L&quot;p_1&quot;</span> <span class=hljs-string >L&quot;p_2&quot;</span> <span class=hljs-string >L&quot;p_3&quot;</span> <span class=hljs-string >L&quot;p_4&quot;</span>])

cost_vec = [cost(el) <span class=hljs-keyword >for</span> el <span class=hljs-keyword >in</span> eachcol(trajectory(mdc))]
p2 = plot(distances(mdc), log.(cost_vec), ylabel=<span class=hljs-string >&quot;log(cost)&quot;</span>, xlabel=<span class=hljs-string >&quot;distance&quot;</span>, title=<span class=hljs-string >&quot;cost over MD curve&quot;</span>);

mdc_plot = plot(p1, p2, layout=(<span class=hljs-number >2</span>, <span class=hljs-number >1</span>), size=(<span class=hljs-number >800</span>, <span class=hljs-number >800</span>))

nominal_trajectory = plot(sol_at_p(mdc(<span class=hljs-number >0.0</span>)[:states]), label=[<span class=hljs-string >&quot;prey&quot;</span> <span class=hljs-string >&quot;predator&quot;</span>])
perturbed_trajectory = plot(sol_at_p(mdc(-<span class=hljs-number >15.0</span>)[:states]), label=[<span class=hljs-string >&quot;prey&quot;</span> <span class=hljs-string >&quot;predator&quot;</span>])

feature_labels = [<span class=hljs-string >&quot;mean prey&quot;</span>, <span class=hljs-string >&quot;max predator&quot;</span>]
<span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >2</span>
    hline!(nominal_trajectory, nom_features, linestyle=:dash, label=feature_labels[i])
    hline!(perturbed_trajectory, features(mdc(-<span class=hljs-number >15.0</span>)[:states]), linestyle=:dash, label=feature_labels[i])
<span class=hljs-keyword >end</span>

<span class=hljs-comment >## Different parameters/trajectories at different points on the curve...but features are preserved, i.e. minimally disrupted!</span>
traj_comparison = plot(nominal_trajectory, perturbed_trajectory, layout=(<span class=hljs-number >2</span>, <span class=hljs-number >1</span>), xlabel=<span class=hljs-string >&quot;time&quot;</span>, ylabel=<span class=hljs-string >&quot;population&quot;</span>)</code></pre> <h3 id=lessons ><a href="#lessons" class=header-anchor >Lessons</a></h3> <ul> <li><p>MinimallyDisruptiveCurves.jl showed how we could continuously vary the parameters of the Lotka-Volterra model, while preserving</p> <ol> <li><p>mean prey population over time</p> <li><p>max predator population over time </p> </ol> <li><p>One strategy &#40;MDC1&#41; was to alter the parameters to increase &#40;decrease&#41; birth and death rates of the predators while decreasing &#40;increasing&#41; those of the prey. Along the axis of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>-strategies to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span>-strategies, this corresponds to one species moving in one direction, with the other going in reverse.</p> <li><p>Another strategy &#40;MDC2&#41; was to modulate the frequency of the oscillations. MDC2 showed us exactly how to change the parameters to continuously modulate this frequency.</p> </ul> <div class=infobox ><p><strong>By the way</strong></p> <p>The maximum predator population over time is a <strong>non differentiable</strong> function of the solution. How come this worked?</p> <ol> <li><p>First note that ReLu units in neural networks are also technically nondifferentiable at a point, but are still used in differentiable machine learning models. Same reason&#33;</p> <li><p>OK the details? The maximum of a collection of elements &#40;predator measurements over time&#41;, is differentiable except at crossing points, where two elements share a maximal value. Different values of predator&#40;t&#41; will never have <strong>exactly</strong> the same value, due to numerical error as well as equation dynamics. So it works out&#33; Indeed, notice the timepoints at which maximal values are attained changes with the model parameters.</p> </ol></div> <div class=page-foot > <div class=copyright > &copy; Dhruva Venkita Raman. Last modified: June 01, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>. </div> </div> </div> </div> </div> </div> <!-- end of class page-wrap-->