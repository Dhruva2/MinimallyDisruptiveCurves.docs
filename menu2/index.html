<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="/MinimallyDisruptiveCurves.docs/libs/katex/katex.min.css">
     
   <link rel="stylesheet" href="/MinimallyDisruptiveCurves.docs/libs/highlight/github.min.css">
   
    <link rel="stylesheet" href="/MinimallyDisruptiveCurves.docs/css/jtd.css">
  <link rel="icon" href="/MinimallyDisruptiveCurves.docs/assets/favicon.ico">

   <title>Examples</title>  
</head>
<body>                      <!-- closed in foot.html -->
<div class="page-wrap">   <!-- closed in foot.html -->
  <!-- SIDE BAR -->
  <div class="side-bar">
    <div class="header">
      <a href="/MinimallyDisruptiveCurves.docs/" class="title">
        User guide
      </a>
    </div>
    <label for="show-menu" class="show-menu">MENU</label>
    <input type="checkbox" id="show-menu" role="button">
    <div class="menu" id="side-menu">
      <ul class="menu-list">
        <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/" class="menu-list-link ">Home</a>
        <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/installation/"class="menu-list-link ">Installation</a>
        <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/menu1/" class="menu-list-link ">How it works</a>
        <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/sceptic/" class="menu-list-link ">Q&A with a sceptic</a>
        <li class="menu-list-item active"><a href="/MinimallyDisruptiveCurves.docs/menu2/" class="menu-list-link active">Examples</a>
        <li class="menu-list-item "><a href="/MinimallyDisruptiveCurves.docs/menu3/" class="menu-list-link ">Tips & Tricks</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="#" class="menu-list-link">Submenu</a>
          </ul>
      </ul>
    </div>
    <div class="footer">
      This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target="_blank">Jekyll theme</a>.
    </div>
  </div>
  <!-- CONTENT -->
  <div class="main-content-wrap"> <!-- closed in foot.html -->
    <div class="main-content">    <!-- closed in foot.html -->
      <div class="main-header">
        <a id="github" href="https://github.com/Dhruva2/MinimallyDisruptiveCurves.jl">MinimallyDisruptiveCurves.jl on GitHub</a>
      </div>



<!-- Content appended here (in class franklin-content) -->
<div class="franklin-content"><h1 id="examples"><a href="#examples">Examples</a></h1>
<div class="franklin-toc"><ol><li><a href="#pulling_notebooks_from_github">Pulling notebooks from Github</a></li><li><a href="#a_copy-paste_minimal_example">A copy-paste, minimal example</a><ol><li><a href="#minimally_disruptive_curve_1">Minimally disruptive curve 1</a></li><li><a href="#minimally_disruptive_curve_2">Minimally disruptive curve 2</a></li><li><a href="#the_code">The code</a></li></ol></li></ol></div>
<p>
<div class="row">
  <div class="container">
    <img class="left" src="/MinimallyDisruptiveCurves.docs/assets/will_it_work.png">
    <div style="clear: both"></div>      
  </div>
</div>
   &#40;<em>Credit: https://xkcd.com/1742/</em>&#41;</p>
<h2 id="pulling_notebooks_from_github"><a href="#pulling_notebooks_from_github">Pulling notebooks from Github</a></h2>
<p>Tutorial notebooks are in the MDCExamples repository. </p>
<ol>
<li><p>At a terminal, in the directory of your choice, type the following commands:</p>
</li>
</ol>
<pre><code class="julia hljs">git clone https://github.com/Dhruva2/MDCExamples.git
cd MDCExamples
julia</code></pre>
<p>This clones the github repository with the examples, changes location to the cloned repository, and starts a julia session.</p>
<ol start="2">
<li><p>In your new julia session, activate the environment:</p>
</li>
</ol>
<pre><code class="julia hljs">] activate .</code></pre>
<p><code>&#93;</code> switches to the package manager. <code>activate .</code> activates the predetermined package environment in which the notebooks can be run.</p>
<ol start="3">
<li><p>&#40;optional&#41;: Precompile the dependencies to save a few minutes later</p>
</li>
</ol>
<pre><code class="julia hljs">] precompile</code></pre>
<ol start="5">
<li><p>Open jupyter notebooks:</p>
</li>
</ol>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> IJulia
notebook(dir=pwd())</code></pre>
<p>and then open/run the individual notebooks in the notebook environment. </p>
<p><strong>Suggested order to go through notebooks</strong></p>
<ol>
<li><p><code>Transforming_cost_functions.ipynb</code></p>
</li>
<li><p><code>MassSpringExample.ipynb</code></p>
</li>
<li><p><code>NFKB_example.ipynb</code></p>
</li>
<li><p><code>stg_neuron_prelim_collocation.ipynb</code></p>
</li>
<li><p><code>CircadianOscillator.ipynb</code></p>
</li>
</ol>
<ul>
<li><p>No. 1 just shows you how to play around with cost functions</p>
</li>
<li><p>No. 2 is an example on an extremely simple model. Running curves takes fractions of a second here, so it&#39;s a good playground for playing with curve settings.</p>
</li>
<li><p>No. 3 is fairly detailed. It&#39;s useful if you want to see how scientific insight can be gained from looking at Minimally Disruptive Curves. Each curve on this notebook takes 2-10 mins to generate on my laptop &#40;2017 macbook pro&#41;.</p>
</li>
<li><p>Nos 4. and 5. show you how to use the &#40;much quicker to evaluate&#41; collocation cost. I&#39;ve generated, but haven&#39;t really had time to properly analyse, the minimally disruptive curves.</p>
</li>
</ul>
<h2 id="a_copy-paste_minimal_example"><a href="#a_copy-paste_minimal_example">A copy-paste, minimal example</a></h2>
<ul>
<li><p>This example is less didactic than the notebooks, but useful for somebody who just wants to get things working quickly.</p>
</li>
<li><p>We do a cursory analysis of the Lotka-Volterra, predator-prey differential equation model. This is often used as a toy example for global sensitivity analysis tools, see e.g. the following web links: <a href="https://cran.r-project.org/web/packages/ODEsensitivity/vignettes/ODEsensitivity.html">a</a>, <a href="https://diffeq.sciml.ai/v6.9/analysis/global_sensitivity/">b</a>, <a href="https://strimas.com/post/lotka-volterra/">c</a>. Because it&#39;s really simple.</p>
</li>
</ul>
<ul>
<li><p>You can copy and paste the code at the bottom, and run it as a .jl script. It runs in seconds &#40;after package/function pre-compilation&#41;. Just make sure you add all the package dependencies first:</p>
</li>
</ul>
<pre><code class="julia hljs">] add OrdinaryDiffEq, ForwardDiff, Statistics, Plots, LinearAlgebra, LaTeXStrings
] add https://github.com/Dhruva2/MinimallyDisruptiveCurves.jl.git</code></pre>
<ul>
<li><p>Note that one of the model features we analyse is <strong>non-differentiable</strong>. Mathematically. Computationally everything works fine, as we&#39;ll explain.</p>
</li>
</ul>
<div class="unobtrusivebox"><p><strong>Lotka Volterra model of predator-prey interactions</strong></p>
<p>The dynamics for the system are:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mtext>🐁</mtext></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><msub><mi>p</mi><mn>1</mn></msub><mtext>🐁</mtext><mo>−</mo><msub><mi>p</mi><mn>2</mn></msub><mtext>🐁🦉</mtext><mspace linebreak="newline"></mspace><mfrac><mrow><mi>d</mi><mtext>🦉</mtext></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><msub><mi>p</mi><mn>3</mn></msub><mtext>🦉</mtext><mo>+</mo><msub><mi>p</mi><mn>4</mn></msub><mtext>🐁🦉</mtext></mrow><annotation encoding="application/x-tex"> \frac{d
🐁}{dt} =  p_1 🐁 - p_2🐁 🦉 \\
\frac{d
🦉}{dt} = -p_3🦉   + p_4 🐁 🦉
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="mord">🐁</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">🐁</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">🐁</span><span class="mord">🦉</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="mord">🦉</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord">−</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">🦉</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">🐁</span><span class="mord">🦉</span></span></span></span></span>
<ul>
<li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">p_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">p_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are the birth and death rates of 🐁 </p>
</li>
<li><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">p_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">p_4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are the birth and death rates of 🦉</p>
</li>
</ul>
<p>... and here is a time-course of their populations when <code>p &#61; &#91;1.5,1.0,3.0,1.0&#93;</code> 
<div class="row">
  <div class="container">
    <img class="left" src="/MinimallyDisruptiveCurves.docs/assets/nominal_lv.png">
    <div style="clear: both"></div>      
  </div>
</div>
</p>
<ul>
<li><p>We will call the system, with these specific parameter values, the <strong>nominal system</strong>.</p>
</li>
</ul></div>
<ul>
<li><p>We will follow <a href="https://diffeq.sciml.ai/v6.9/analysis/global_sensitivity/">b</a> in having <strong>two</strong> features of interest: </p>
<ul>
<li><p><strong>mean</strong> population of 🐁  over time</p>
</li>
<li><p><strong>max</strong> population of 🦉 over time</p>
</li>
</ul>
</li>
</ul>
<div class="infobox"><p><strong>By the way</strong> In your ecology class, you may have heard of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi mathvariant="normal">/</mi><mi>K</mi></mrow><annotation encoding="application/x-tex">r/K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span> selection. This is a &#40;criticised&#41; theory of how there are two extremal strategies that individual species trade off between:  </p>
<ul>
<li><p>r-Strategists &#40;e.g. rabbits&#41;: <strong>high</strong> birth and death rate. <strong>low</strong> investment in individual organisms</p>
</li>
<li><p>K-strategists &#40;e.g. humans&#41;: <strong>low</strong> birth and death rate. <strong>high</strong> investment in individual organisms</p>
</li>
</ul>
<p>We will use this terminology in our description of the MD curves.</p></div>
<ul>
<li><p>By running the code at the bottom of the page twice, setting <code>whichdir &#61; 1</code> and <code>whichdir&#61;2</code> respectively, we get two MD curves &#40;see below&#41;.</p>
</li>
<li><p>On the first curve, predators </p>
</li>
</ul>
<div class="unobtrusivebox"><h3 id="minimally_disruptive_curve_1"><a href="#minimally_disruptive_curve_1">Minimally disruptive curve 1</a></h3>
<p><br/> </p>
<ul>
<li><p>The main panel depicts how each of the four parameters change along the curve. Distance from the starting point on the curve is the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>-axis. </p>
</li>
<li><p>Any point on the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>-axis defines a set of parameters. </p>
</li>
<li><p>We take the farthest set of parameters &#40;distance &#61; 15&#41;, and simulate the model. Look&#33; Model features are almost exactly the same as the nominal&#33;</p>
</li>
</ul>

<div class="row">
  <div class="container">
    <img class="left" src="/MinimallyDisruptiveCurves.docs/assets/lotka_mdc1.svg">
    <div style="clear: both"></div>      
  </div>
</div>

<ul>
<li><p>As we move along the curve, predators move towards an <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>-strategy, and prey moves towards a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span>-strategy.</p>
</li>
<li><p>If cost &gt; momentum, the curve terminates. We set momentum &#61; 1. So the curve stops early on the RHS.</p>
</li>
</ul></div>
<div class="unobtrusivebox"><h3 id="minimally_disruptive_curve_2"><a href="#minimally_disruptive_curve_2">Minimally disruptive curve 2</a></h3>
<p><br/> </p>
<ul>
<li><p>As we move along the curve, predators move towards an <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span>-strategy, and prey moves towards a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>-strategy. The opposite of mdc1&#33;</p>
</li>
</ul>

<div class="row">
  <div class="container">
    <img class="left" src="/MinimallyDisruptiveCurves.docs/assets/lotka_mdc2.svg">
    <div style="clear: both"></div>      
  </div>
</div></div>
<h3 id="the_code"><a href="#the_code">The code</a></h3>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> OrdinaryDiffEq, ForwardDiff, MinimallyDisruptiveCurves, Statistics, Plots, LinearAlgebra, LaTeXStrings

<span class="hljs-comment">#which md curve to plot</span>
which_dir = <span class="hljs-number">2</span>

<span class="hljs-comment">## define dynamics of differential equation</span>
<span class="hljs-keyword">function</span> f(du,u,p,t)
  du[<span class="hljs-number">1</span>] = p[<span class="hljs-number">1</span>]*u[<span class="hljs-number">1</span>] - p[<span class="hljs-number">2</span>]*u[<span class="hljs-number">1</span>]*u[<span class="hljs-number">2</span>] <span class="hljs-comment">#prey</span>
  du[<span class="hljs-number">2</span>] = -p[<span class="hljs-number">3</span>]*u[<span class="hljs-number">2</span>] + p[<span class="hljs-number">4</span>]*u[<span class="hljs-number">1</span>]*u[<span class="hljs-number">2</span>] <span class="hljs-comment">#predator</span>
<span class="hljs-keyword">end</span>

u0 = [<span class="hljs-number">1.0</span>;<span class="hljs-number">1.0</span>] <span class="hljs-comment"># initial populations</span>
tspan = (<span class="hljs-number">0.0</span>,<span class="hljs-number">10.0</span>) <span class="hljs-comment">#time span to simulate over</span>
t = collect(range(<span class="hljs-number">0</span>, stop=<span class="hljs-number">10.</span>, length=<span class="hljs-number">200</span>)) <span class="hljs-comment"># time points to measure</span>
p = [<span class="hljs-number">1.5</span>,<span class="hljs-number">1.0</span>,<span class="hljs-number">3.0</span>,<span class="hljs-number">1.0</span>] <span class="hljs-comment"># initial parameter values</span>
nom_prob = ODEProblem(f,u0,tspan,p) <span class="hljs-comment"># package as an ODE problem</span>
nom_sol = solve(nom_prob, Tsit5()) <span class="hljs-comment"># solve </span>


<span class="hljs-comment">## Model features of interest are mean prey population, and max predator population (over time)</span>
<span class="hljs-keyword">function</span> features(p)
  prob = remake(nom_prob; p=p)
  sol = solve(prob, Tsit5(); saveat = t)
  <span class="hljs-keyword">return</span> [mean(sol[<span class="hljs-number">1</span>,:]), maximum(sol[<span class="hljs-number">2</span>,:])]
<span class="hljs-keyword">end</span>

nom_features = features(p)

<span class="hljs-comment">## loss function, we can take as l2 difference of features vs nominal features</span>
<span class="hljs-keyword">function</span> loss(p)
  prob = remake(nom_prob; p=p)
  p_features = features(p)
  loss = sum(abs2, p_features - nom_features)
  <span class="hljs-keyword">return</span> loss
<span class="hljs-keyword">end</span>

<span class="hljs-comment">## gradient of loss function</span>
<span class="hljs-keyword">function</span> lossgrad(p,g)
  g[:] = ForwardDiff.gradient(p) <span class="hljs-keyword">do</span> p
    loss(p)
  <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> loss(p)
<span class="hljs-keyword">end</span>

<span class="hljs-comment">## package the loss and gradient into a DiffCost structure</span>
cost = DiffCost(loss, lossgrad)

<span class="hljs-string">&quot;&quot;&quot;
We evaluate the hessian once only, at p.
Why? to find locally insensitive directions of parameter perturbation
The small eigenvalues of the Hessian are one easy way of defining these directions 
&quot;&quot;&quot;</span>
hess0 = ForwardDiff.hessian(loss,p)
ev(i) = eigen(hess0).vectors[:,i]

<span class="hljs-comment">## Now we set up a minimally disruptive curve, with nominal parameters p and initial direction ev(1) </span>
init_dir = ev(which_dir); momentum = <span class="hljs-number">1.</span>; span = (-<span class="hljs-number">15.</span>,<span class="hljs-number">15.</span>)
curve_prob = curveProblem(cost, p, init_dir, momentum, span)
<span class="hljs-meta">@time</span> mdc = evolve(curve_prob, Tsit5)

<span class="hljs-keyword">function</span> sol_at_p(p)
  prob = remake(nom_prob; p=p)
  sol = solve(prob, Tsit5())
<span class="hljs-keyword">end</span>

p1 = plot(mdc; pnames = [<span class="hljs-string">L&quot;p_1&quot;</span> <span class="hljs-string">L&quot;p_2&quot;</span> <span class="hljs-string">L&quot;p_3&quot;</span> <span class="hljs-string">L&quot;p_4&quot;</span>])

cost_vec = [mdc.cost(el) <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> eachcol(trajectory(mdc))]
p2 = plot(distances(mdc), log.(cost_vec), ylabel = <span class="hljs-string">&quot;log(cost)&quot;</span>, xlabel = <span class="hljs-string">&quot;distance&quot;</span>, title = <span class="hljs-string">&quot;cost over MD curve&quot;</span>);

mdc_plot = plot(p1,p2, layout=(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>), size = (<span class="hljs-number">800</span>,<span class="hljs-number">800</span>))

nominal_trajectory = plot(sol_at_p(mdc(<span class="hljs-number">0.</span>)[:states]), label = [<span class="hljs-string">&quot;prey&quot;</span> <span class="hljs-string">&quot;predator&quot;</span>])
perturbed_trajectory = plot(sol_at_p(mdc(-<span class="hljs-number">15.</span>)[:states]), label = [<span class="hljs-string">&quot;prey&quot;</span> <span class="hljs-string">&quot;predator&quot;</span>])
traj_comparison = plot(nominal_trajectory, perturbed_trajectory, layout = (<span class="hljs-number">2</span>,<span class="hljs-number">1</span>), xlabel = <span class="hljs-string">&quot;time&quot;</span>, ylabel = <span class="hljs-string">&quot;population&quot;</span>)</code></pre>
<div class="page-foot">
  <div class="copyright">
    &copy; Dhruva Venkita Raman. Last modified: October 10, 2020. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div>
</div><!-- CONTENT ENDS HERE -->
    </div> <!-- end of class main-content -->
    </div> <!-- end of class main-content-wrap -->
    </div> <!-- end of class page-wrap-->
    
      



    
    
      


    
  </body>
</html>
